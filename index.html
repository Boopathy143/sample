<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sample Control System</title>

<style>
body{margin:0;font-family:Segoe UI;background:#f4f6fa;}
header{background:#1e293b;color:white;padding:12px;text-align:center;font-weight:bold;}
.container{padding:12px;}
.card{background:white;padding:14px;border-radius:10px;margin-bottom:14px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
input,select{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc;}
button{padding:8px;border:none;border-radius:6px;background:#2563eb;color:white;font-weight:bold;margin-top:4px;cursor:pointer;}

.grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;}
.rack{padding:10px;text-align:center;border-radius:8px;font-size:12px;font-weight:bold;}
.active{background:#16a34a;color:white;}
.empty{background:#e5e7eb;}
.small-text{font-size:11px;font-weight:normal;}
</style>
</head>

<body>

<header>SAMPLE CONTROL SYSTEM</header>

<div class="container">

<div class="card">
<h3>Add Sample</h3>

<select id="rack"></select>

<input type="text" id="lot" placeholder="Lot Number">

<select id="brand">
<option value="">Select Brand</option>
<option>OOM ADVANCE</option>
<option>NIHAR ADVANCE</option>
<option>OOM GOLD</option>
<option>NIHAR GOLD</option>
<option>PARACHUTE</option>
</select>

<input type="text" id="pmcode" placeholder="PM Code">

<select id="sku">
<option value="">Select SKU</option>
<option value="35ft">35ft</option>
<option value="60ft">60ft</option>
<option value="90ft">90ft</option>
<option value="160ft">160ft</option>
<option value="450ft">450ft</option>
<option value="500ft">500ft</option>
</select>

<input type="number" id="bottles" placeholder="Bottle Count">
<input type="date" id="sampleDate">

<button onclick="addSample()">Submit</button>
</div>

<div class="card">
<h3>Rack Dashboard</h3>
<div class="grid" id="rackGrid"></div>
</div>

</div>

<script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxgk0vQg47NjKkCRGh-xPeer_2yaAjHyH9S2hr2IxMCArEsxku5d3wXjB1OwIaULa0i/exec";

let data = [];

// ===== CREATE RACK DROPDOWN =====
const rackSelect = document.getElementById("rack");
for(let i=1;i<=135;i++){
 let opt=document.createElement("option");
 opt.value=i;
 opt.text="Rack "+i;
 rackSelect.appendChild(opt);
}

// ===== LOAD DATA =====
async function loadData(){
  try{
    const res = await fetch(WEB_APP_URL);
    data = await res.json();
    renderRack();
  }catch(err){
    console.error("Load error:",err);
  }
}

// ===== ADD SAMPLE =====
async function addSample(){

 let rack=document.getElementById("rack").value;
 let lot=document.getElementById("lot").value;
 let brand=document.getElementById("brand").value;
 let pmcode=document.getElementById("pmcode").value;
 let sku=document.getElementById("sku").value;
 let bottles=document.getElementById("bottles").value;
 let sampleDateInput=document.getElementById("sampleDate").value;

 if(!rack||!lot||!brand||!pmcode||!sku||!bottles||!sampleDateInput){
  alert("Fill all fields");
  return;
 }

 let sampleDate=new Date(sampleDateInput);
 let expiry=new Date(sampleDate);
 expiry.setMonth(expiry.getMonth()+21);

 try{
   await fetch(WEB_APP_URL,{
     method:"POST",
     body:JSON.stringify({
       action:"add",
       id:Date.now(),
       rack,lot,brand,pmcode,sku,bottles,
       sampleDate:sampleDate.toISOString(),
       expiry:expiry.toISOString(),
       status:"ACTIVE"
     })
   });

   alert("Saved Successfully");
   loadData();

 }catch(err){
   console.error("Save error:",err);
 }
}

// ===== RENDER RACK =====
function renderRack(){

 let grid=document.getElementById("rackGrid");
 grid.innerHTML="";

 for(let i=1;i<=135;i++){

  let rackData=data.filter(d=>d.rack==i && d.status!=="SCRAPPED");

  let div=document.createElement("div");
  div.classList.add("rack");

  if(rackData.length===0){
   div.classList.add("empty");
   div.innerHTML="Rack "+i+"<br><span class='small-text'>Empty</span>";
  }else{
   div.classList.add("active");
   div.innerHTML="Rack "+i+"<br><span class='small-text'>"+rackData.length+" Lots</span>";
  }

  grid.appendChild(div);
 }
}

// INITIAL LOAD
loadData();

</script>

</body>
</html>
